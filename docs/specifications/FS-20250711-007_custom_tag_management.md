# 기능 명세 (Feature Specification)

*   **문서 ID**: `FS-20250711-007`
*   **작성일**: `2025년 7월 11일`
*   **작성자**: `Gemini`
*   **기능명**: `사용자 정의 태그 관리 기능`

---

### 1. 개요 (Overview)

이 기능은 사용자가 FileTagger 애플리케이션에서 자주 사용하는 태그들을 관리할 수 있도록 합니다. 사용자는 자주 사용하는 태그들을 빠른 태그 목록에 추가, 삭제, 순서 변경할 수 있으며, 이 목록은 JSON 파일에 영속적으로 저장되어 애플리케이션 재시작 시에도 유지됩니다. 관리된 빠른 태그들은 태그 제어 위젯에서 버튼 형태로 표시되어 빠른 태깅 작업을 지원합니다.

### 2. 주요 기능 상세 (Detailed Functional Description)

*   **2.1. 기능 설명**:
    *   **빠른 태그 관리**: 사용자가 메뉴바의 "도구 > 빠른 태그 관리"를 통해 자주 사용하는 태그 목록을 관리할 수 있습니다.
    *   **태그 추가**: 새로운 태그를 입력하여 빠른 태그 목록에 추가할 수 있습니다. 중복 태그는 허용하지 않습니다.
    *   **태그 삭제**: 선택된 태그를 빠른 태그 목록에서 제거할 수 있습니다.
    *   **순서 변경**: 태그의 순서를 위/아래 버튼을 통해 변경할 수 있습니다.
    *   **영속성 저장**: 관리된 태그 목록은 `custom_tags.json` 파일에 저장되어 애플리케이션 재시작 시에도 유지됩니다.
    *   **실시간 적용**: 태그 관리 다이얼로그에서 저장한 변경사항이 즉시 태그 제어 위젯에 반영됩니다.

*   **2.2. 입력/출력**:
    *   **입력**:
        *   사용자가 입력한 새 태그명
        *   태그 추가/삭제/순서 변경 명령
        *   저장/취소 명령
    *   **출력**:
        *   업데이트된 빠른 태그 목록
        *   성공/실패 메시지
        *   `custom_tags.json` 파일 업데이트
        *   태그 제어 위젯의 빠른 태그 버튼 업데이트

*   **2.3. 정상 흐름**:
    1.  사용자가 메뉴바에서 "도구 > 빠른 태그 관리"를 클릭합니다.
    2.  `MainWindow.open_custom_tag_dialog()` 메서드가 호출되어 `CustomTagDialog`를 생성합니다.
    3.  `CustomTagDialog`가 초기화되면서 `CustomTagManager.load_custom_quick_tags()`를 호출하여 저장된 태그 목록을 로드합니다.
    4.  로드된 태그들이 다이얼로그의 리스트 위젯에 표시됩니다.
    5.  **태그 추가 시**:
        *   사용자가 태그 입력 필드에 새 태그명을 입력하고 "추가" 버튼을 클릭하거나 Enter 키를 누릅니다.
        *   입력된 태그가 비어있지 않은지 확인합니다.
        *   중복 태그인지 확인하고, 중복인 경우 경고 메시지를 표시합니다.
        *   유효한 태그인 경우 리스트 위젯에 추가하고 입력 필드를 초기화합니다.
    6.  **태그 삭제 시**:
        *   사용자가 리스트에서 태그를 선택하고 "선택 태그 제거" 버튼을 클릭합니다.
        *   선택된 태그가 있는지 확인하고, 없으면 경고 메시지를 표시합니다.
        *   선택된 태그들을 리스트에서 제거합니다.
    7.  **순서 변경 시**:
        *   사용자가 태그를 선택하고 "위로 이동" 또는 "아래로 이동" 버튼을 클릭합니다.
        *   선택된 태그의 위치를 리스트에서 변경합니다.
    8.  **저장 시**:
        *   사용자가 "확인" 버튼을 클릭합니다.
        *   `CustomTagManager.save_custom_quick_tags()`를 호출하여 현재 태그 목록을 JSON 파일에 저장합니다.
        *   저장 성공 시 성공 메시지를 표시하고 다이얼로그를 닫습니다.
        *   저장 실패 시 오류 메시지를 표시하고 다이얼로그를 유지합니다.
    9.  **취소 시**:
        *   사용자가 "취소" 버튼을 클릭하거나 다이얼로그를 닫습니다.
        *   변경사항을 저장하지 않고 다이얼로그를 닫습니다.
    10. **다이얼로그 종료 후**:
        *   저장이 성공한 경우 `TagControlWidget`의 빠른 태그 위젯들을 새로고침합니다.
        *   `individual_quick_tags.load_quick_tags()`와 `batch_quick_tags.load_quick_tags()`를 호출하여 UI를 업데이트합니다.

*   **2.4. 예외 처리**:
    *   **빈 태그 입력**: 태그명이 비어있는 경우 "태그를 입력해주세요." 경고 메시지를 표시합니다.
    *   **중복 태그**: 이미 존재하는 태그를 추가하려는 경우 "이미 존재하는 태그입니다." 경고 메시지를 표시합니다.
    *   **태그 미선택**: 태그를 선택하지 않고 삭제/이동을 시도하는 경우 적절한 경고 메시지를 표시합니다.
    *   **파일 저장 오류**: JSON 파일 저장 중 오류가 발생하는 경우 "태그 저장에 실패했습니다." 오류 메시지를 표시합니다.
    *   **파일 로드 오류**: JSON 파일 로드 중 오류가 발생하는 경우 빈 목록으로 시작하고 오류를 로그에 기록합니다.

### 3. UI/UX 요소 (UI/UX Elements)

*   **CustomTagDialog**:
    *   **설명 라벨**: "자주 사용하는 태그를 추가, 제거, 순서 변경하세요." 안내 텍스트
    *   **태그 입력 필드**: 새 태그를 입력할 수 있는 `QLineEdit` 위젯
    *   **추가 버튼**: 입력된 태그를 목록에 추가하는 버튼
    *   **태그 리스트**: 현재 빠른 태그 목록을 표시하는 `QListWidget`
    *   **위로 이동 버튼**: 선택된 태그를 위로 이동하는 버튼
    *   **아래로 이동 버튼**: 선택된 태그를 아래로 이동하는 버튼
    *   **선택 태그 제거 버튼**: 선택된 태그를 목록에서 제거하는 버튼
    *   **확인/취소 버튼**: 변경사항을 저장하거나 취소하는 표준 다이얼로그 버튼
*   **메뉴바**: "도구" 메뉴 아래 "빠른 태그 관리(&Q)" 항목
*   **메시지 박스**: 경고 및 오류 메시지를 표시하는 `QMessageBox`

### 4. 기술적 구현 (Technical Implementation)

*   **CustomTagManager**:
    *   `load_custom_quick_tags() -> list[str]`: JSON 파일에서 빠른 태그 목록을 로드하는 메서드
    *   `save_custom_quick_tags(tags: list[str]) -> bool`: 빠른 태그 목록을 JSON 파일에 저장하는 메서드
    *   JSON 파일 경로: `config.CUSTOM_TAGS_FILE` (기본값: "custom_tags.json")
*   **CustomTagDialog**:
    *   `__init__(custom_tag_manager, parent)`: 다이얼로그 초기화 및 UI 설정
    *   `load_tags()`: 저장된 태그 목록을 로드하여 리스트 위젯에 표시
    *   `_add_tag()`: 새 태그를 추가하는 메서드 (중복 검사 포함)
    *   `_remove_selected_tag()`: 선택된 태그를 제거하는 메서드
    *   `_move_tag_up()`: 선택된 태그를 위로 이동하는 메서드
    *   `_move_tag_down()`: 선택된 태그를 아래로 이동하는 메서드
    *   `_save_tags()`: 현재 태그 목록을 저장하는 메서드
    *   `get_updated_tags() -> list[str]`: 현재 태그 목록을 반환하는 메서드
*   **MainWindow**:
    *   `open_custom_tag_dialog()`: 빠른 태그 관리 다이얼로그를 열고 결과를 처리하는 메서드
*   **TagControlWidget**:
    *   `individual_quick_tags.load_quick_tags()`: 개별 태깅 탭의 빠른 태그 위젯 새로고침
    *   `batch_quick_tags.load_quick_tags()`: 일괄 태깅 탭의 빠른 태그 위젯 새로고침

### 5. 테스트 케이스 (Test Cases)

*   **TC-FS-059**: 빠른 태그 관리 다이얼로그가 올바르게 열리는지 확인
*   **TC-FS-060**: 저장된 빠른 태그 목록이 다이얼로그에 올바르게 로드되는지 확인
*   **TC-FS-061**: 새 태그를 추가할 수 있는지 확인
*   **TC-FS-062**: 빈 태그 입력 시 적절한 경고 메시지가 표시되는지 확인
*   **TC-FS-063**: 중복 태그 추가 시 적절한 경고 메시지가 표시되는지 확인
*   **TC-FS-064**: 선택된 태그를 삭제할 수 있는지 확인
*   **TC-FS-065**: 태그 선택 없이 삭제 시도 시 적절한 경고 메시지가 표시되는지 확인
*   **TC-FS-066**: 태그 순서를 위/아래로 변경할 수 있는지 확인
*   **TC-FS-067**: 태그 목록을 저장할 수 있는지 확인
*   **TC-FS-068**: 저장된 태그 목록이 애플리케이션 재시작 후에도 유지되는지 확인
*   **TC-FS-069**: 저장 실패 시 적절한 오류 메시지가 표시되는지 확인
*   **TC-FS-070**: 취소 시 변경사항이 저장되지 않는지 확인
*   **TC-FS-071**: 저장 후 태그 제어 위젯의 빠른 태그 버튼이 업데이트되는지 확인

### 6. 관련 파일/모듈 (Related Files/Modules)

*   `main_window.py`: 메인 UI 및 빠른 태그 관리 다이얼로그 호출
*   `widgets/custom_tag_dialog.py`: 빠른 태그 관리 다이얼로그 구현
*   `core/custom_tag_manager.py`: 빠른 태그 데이터 영속성 관리
*   `widgets/tag_control_widget.py`: 태그 제어 위젯 및 빠른 태그 위젯 관리
*   `widgets/quick_tags_widget.py`: 빠른 태그 버튼 위젯
*   `config.py`: 빠른 태그 파일 경로 설정
*   `ui/custom_tag_dialog.ui`: 빠른 태그 관리 다이얼로그 UI 정의
*   `ui/main_window.ui`: 메뉴바 UI 정의

--- 