# 개발 요청 명세 (Development Request Specification)

## DRS-20250705-002_Tagging_UI_UX_Integration

- **제목**: 태그 기능 UI/UX 통합 및 중복 해소
- **제출 팀**: PM/PL
- **제출일**: 2025년 7월 5일
- **관련 이슈**:
    - [이슈] 일괄 태그 추가 기능 QA 테스트 요청 (2025-07-05)
    - [이슈] `core/tag_manager.py` 내 `add_tags_to_directory` 메서드 로컬 `os` 변수 참조 오류 (2025-07-05)
    - [이슈] `test_batch_tagging_ui.py`의 `TagManager` 모의 객체 `bulk_write` 동작 불일치 (2025-07-05)
    - [이슈] 태그 기능 UI/UX 통합 및 중복 해소 필요 (2025-07-05)

### 1. 목표 (Goals)

- **개별 파일 태깅 기능과 일괄 태그 추가 기능의 UI/UX 통합**: 사용자가 하나의 일관된 인터페이스 내에서 개별 파일 태깅과 디렉토리 일괄 태깅 작업을 수행할 수 있도록 합니다.
- **중복된 UI 컴포넌트 및 로직 제거**: 현재 `main_window.py`와 `widgets/batch_tagging_panel.py`에 분산되어 있는 파일/디렉토리 선택, 파일 목록/미리보기, 태그 입력/표시 등 중복된 UI 요소와 관련 로직을 통합하고 재사용 가능한 컴포넌트로 분리하여 코드의 응집도를 높이고 유지보수성을 향상시킵니다.
- **사용자 경험(UX) 일관성 및 향상**: 기능 간의 전환을 자연스럽게 하고, 사용자 혼란을 최소화하여 전반적인 애플리케이션 사용성을 개선합니다.
- **유지보수성 및 확장성 향상**: 모듈화된 아키텍처를 통해 향후 기능 추가 및 변경이 용이하도록 기반을 마련합니다.
- **기존 이슈 해결**: 이 통합 작업을 통해 `add_tags_to_directory` 메서드 오류 및 `test_batch_tagging_ui.py` 테스트 실패와 같은 기존 버그들이 자연스럽게 해결되거나, 새로운 구조에 맞춰 재검토될 수 있도록 합니다.

### 2. 현황 분석 (Current State Analysis)

- `main_window.py`는 파일 시스템 탐색, 개별 파일 선택 및 태그 관리(TagInputWidget, QuickTagsWidget, btn_save_tags)를 담당합니다.
- `widgets/batch_tagging_panel.py`는 디렉토리 선택, 파일 미리보기, 태그 입력, 일괄 적용 등 일괄 태그 추가를 위한 독립적인 UI와 로직을 가집니다.
- `TagUIStateManager`는 `main_window.py` 내의 일부 태그 관련 위젯(TagInputWidget, QuickTagsWidget, btn_save_tags)의 활성화/비활성화 상태를 관리하지만, `BatchTaggingPanel`의 상태는 직접 관리하지 않습니다.
- 결과적으로, 파일/디렉토리 선택, 태그 입력 등 유사한 기능이 여러 곳에 분산되어 있어 코드 중복이 발생하고, 사용자 입장에서는 기능 간의 일관성이 부족합니다.

### 3. 제안 아키텍처 및 변경 사항 (Proposed Architecture & Changes)

#### 3.1. 통합 패널 도입

- `MainWindow` 내에 "파일/태그 관리 패널"과 같은 통합된 메인 패널을 도입합니다.
- 이 통합 패널은 내부적으로 "개별 태깅" 모드와 "일괄 태깅" 모드를 전환할 수 있는 기능을 **탭(Tab) 방식**으로 제공합니다.
- `MainWindow`는 이 통합 패널의 가시성 제어 및 모드 전환 로직만 담당하고, 실제 태깅 관련 UI/UX 로직은 통합 패널 내부에서 처리하도록 역할을 분산합니다.

#### 3.2. 공통 컴포넌트화

- **파일/디렉토리 선택 및 미리보기 컴포넌트**: 현재 `main_window.py`의 파일 목록(`tableView_files`)과 `widgets/batch_tagging_panel.py`의 파일 미리보기(`file_table`) 기능을 통합하여 재사용 가능한 단일 컴포넌트(예: `FileSelectionAndPreviewWidget`)로 분리합니다. 이 컴포넌트는 **트리 뷰(Tree View)와 테이블 뷰(Table View)를 결합한 형태**로 설계합니다.
    - **트리 뷰**: 좌측에 디렉토리 탐색을 위한 트리 뷰를 배치하여 사용자가 디렉토리를 쉽게 선택할 수 있도록 합니다.
    - **테이블 뷰**: 우측에 선택된 디렉토리 내의 파일 목록을 표시하는 테이블 뷰를 배치합니다. 이 테이블 뷰는 최소한 **파일명, 상대 경로, 현재 적용된 태그**를 표시해야 합니다.
    - **우선순위 및 요구사항**:
        - **높음**: 기본 파일 정보(파일명, 경로, 태그) 표시 기능.
        - **중간**: 파일 확장자별 아이콘 표시 등 시각적 개선.
        - **낮음**: 이미지 썸네일 미리보기, 텍스트 파일 내용 미리보기 등 고급 미리보기 기능은 이번 통합 범위에서는 제외하고, 향후 기능 개선 시 고려합니다.
- **태그 입력 및 표시 컴포넌트**: `TagInputWidget`과 `QuickTagsWidget`은 현재도 재사용되고 있으므로, 이들을 통합 패널 내에서 공통적으로 활용합니다. 필요한 경우 `TagInputWidget`의 기능을 확장하여 태그 검색 및 자동 완성 기능을 포함할 수 있습니다.

#### 3.3. `TagUIStateManager` 확장

- `TagUIStateManager`의 역할을 확장하여 통합 패널의 전반적인 상태를 관리하도록 합니다.
- **관리할 상태**: 현재 태깅 모드("개별 태깅" 또는 "일괄 태깅"), 선택된 파일/디렉토리 경로, 태그 적용 가능 여부(파일 선택 여부, 유효한 디렉토리 선택 여부 등), 공통 UI 컴포넌트의 활성화/비활성화 상태(`TagInputWidget`, `QuickTagsWidget`, 태그 저장/적용 버튼 등).
- **세분화 수준**: 각 위젯 내부의 세부적인 상태(예: `TagInputWidget` 내의 개별 태그 칩 추가/제거)는 해당 위젯 자체에서 관리하되, `TagUIStateManager`는 위젯의 전반적인 활성화 상태 및 모드에 따른 가시성 제어에 집중합니다.
- `TagUIStateManager`는 통합 패널 내의 모든 하위 컴포넌트의 활성화/비활성화 상태를 중앙에서 제어합니다.
- `MainWindow`는 `TagUIStateManager`의 상태 변경 시그널을 받아 필요한 UI 업데이트를 수행합니다.

#### 3.4. `BatchTaggingPanel` 리팩토링

- `widgets/batch_tagging_panel.py`는 더 이상 독립적인 패널이 아닌, 통합 패널 내의 "일괄 태깅" 모드에 특화된 서브 컴포넌트 또는 로직 모듈로 리팩토링됩니다.
- `BatchTaggingPanel` 내부에 중복된 파일 선택/미리보기 로직은 새로 생성될 공통 컴포넌트를 사용하도록 수정합니다.
- `BatchTaggingPanel`의 `BatchTaggingWorker`와 같은 핵심 비즈니스 로직은 유지하되, UI와의 결합도를 낮춥니다.

### 4. UI/UX 흐름 (예시)

1.  **초기 화면**: 애플리케이션 실행 시 통합 패널이 기본적으로 "개별 태깅" 모드로 표시됩니다. 파일 시스템 트리와 파일 목록이 보이고, 파일 선택 시 태그 입력 위젯과 빠른 태그 위젯이 활성화됩니다.
2.  **모드 전환**: 통합 패널 상단 또는 좌측에 "개별 태깅"과 "일괄 태깅"을 전환할 수 있는 **탭(Tab)**이 제공됩니다.
3.  **일괄 태깅 모드**: "일괄 태깅" 모드 선택 시, 통합 패널의 내용이 일괄 태깅에 특화된 UI(디렉토리 선택, 재귀/확장자 옵션, 일괄 적용 버튼 등)로 변경됩니다. 이때 파일 목록/미리보기 영역은 일괄 태깅 대상 파일을 보여주도록 전환됩니다. 태그 입력 위젯과 빠른 태그 위젯은 개별 태깅 모드와 동일하게 사용됩니다.
4.  **파일/디렉토리 선택**: 통합된 파일 선택 컴포넌트를 통해 개별 파일 또는 디렉토리를 선택할 수 있습니다. 선택된 내용에 따라 태그 입력 위젯의 활성화 여부 및 적용 대상이 결정됩니다.
5.  **태그 적용**: 개별 태깅 모드에서는 선택된 파일에 태그가 적용되고, 일괄 태깅 모드에서는 선택된 디렉토리 내 파일들에 태그가 일괄 적용됩니다.

### 5. 기존 버그 처리 및 우선순위

- **기존 버그 처리**: 구조 개편과 병행하여 기존 버그들을 해결합니다. 특히 `add_tags_to_directory` 메서드 오류 및 `test_batch_tagging_ui.py`의 테스트 불일치 문제는 통합 작업의 안정성과 신뢰성에 직접적인 영향을 미치므로, 이번 통합 과정에서 반드시 해결되어야 합니다.
- **우선순위 조정**: 기존 버그들이 이미 해결되었을 가능성을 고려하여, 해당 버그들의 해결 여부를 먼저 확인하고, 만약 해결되지 않았다면 통합 작업과 병행하여 해결합니다. 이 버그들은 통합 작업의 안정성을 확보하는 데 필수적이므로, 통합 작업의 진행을 막는 블로커로 간주합니다.

### 6. 영향 받는 파일/모듈 (Affected Files/Modules)

- `main_window.py`: 통합 패널 도입, 역할 분산, 시그널/슬롯 재연결 등 대대적인 수정.
- `widgets/batch_tagging_panel.py`: 통합 패널의 서브 컴포넌트로 리팩토링, 중복 로직 제거.
- `widgets/tag_input_widget.py`: 기존 기능 유지 및 통합 패널 내에서 재사용.
- `widgets/quick_tags_widget.py`: 기존 기능 유지 및 통합 패널 내에서 재사용.
- `core/tag_ui_state_manager.py`: 통합 패널의 상태 관리를 위한 기능 확장.
- `core/tag_manager.py`: `add_tags_to_directory` 메서드 오류 수정 (DRS-20250705-002와 별개로 개발팀에서 수정 필요).
- `tests/test_batch_tagging_ui.py`: 통합 패널 구조에 맞춰 테스트 코드 리팩토링 및 `TagManager` 모의 객체 `bulk_write` 동작 불일치 해결.
- **신규 파일 (예상)**:
    - `widgets/unified_tagging_panel.py` (통합 패널 메인 위젯)
    - `widgets/file_selection_and_preview_widget.py` (공통 파일/디렉토리 선택 및 미리보기 컴포넌트)

### 7. 검증 기준 (Verification Criteria)

- **기능 동작**:
    - 통합된 UI에서 개별 파일 태깅 및 일괄 태그 추가 기능이 모두 정상적으로 동작하는가?
    - 모드 전환(개별/일괄) 시 UI가 자연스럽게 변경되고, 각 모드에서 필요한 기능이 올바르게 활성화/비활성화되는가?
    - 파일/디렉토리 선택, 태그 입력, 태그 적용 등 모든 사용자 인터랙션이 예상대로 동작하는가?
- **코드 품질**:
    - 코드 중복이 효과적으로 해소되었는가?
    - `main_window.py`의 역할이 성공적으로 분산되었는가?
    - `TagUIStateManager`가 통합된 UI의 상태를 올바르게 관리하고 제어하는가?
    - 새로운 컴포넌트들이 재사용 가능하고 모듈화되어 있는가?
- **버그 해결**:
    - `core/tag_manager.py` 내 `add_tags_to_directory` 메서드의 `os` 변수 참조 오류가 해결되었는가?
    - `test_batch_tagging_ui.py`의 `TagManager` 모의 객체 `bulk_write` 동작 불일치 문제가 해결되어 테스트가 정상적으로 통과하는가?
- **성능 및 안정성**:
    - 통합 후에도 애플리케이션의 성능 저하가 없는가?
    - 예외 상황(잘못된 경로, 권한 문제 등)에 대한 적절한 에러 처리 및 사용자 피드백이 제공되는가?

### 8. 테스트 코드 리팩토링 범위

- 통합 구조에 맞춰 **테스트 코드를 전면적으로 리팩토링하고 확장**해야 합니다.
    - **기존 테스트 업데이트**: 기존 `test_batch_tagging_ui.py` 및 관련 테스트들을 새로운 통합 컴포넌트 구조에 맞게 수정합니다.
    - **모드 전환 테스트**: 탭 전환 시 UI 상태 변화 및 기능 동작의 유효성을 검증하는 테스트 케이스를 추가합니다.
    - **통합 컴포넌트 테스트**: 새로 생성될 `FileSelectionAndPreviewWidget`과 같은 공통 컴포넌트에 대한 단위 및 통합 테스트를 작성합니다.
    - **버그 재현/해결 테스트**: `bulk_write` 모의 객체 불일치와 같은 기존 버그가 해결되었음을 검증하는 테스트를 강화합니다.
    - **우선순위**: 통합 패널의 핵심 기능(모드 전환, 파일/디렉토리 선택, 태그 입력/적용)에 대한 통합 테스트를 최우선으로 진행합니다.

### 9. 예상 완료일 (Estimated Completion Date)

- 개발팀과 협의 후 결정. (DRS 승인 후 개발팀에서 산정)

---

### [2025-07-12] UI/UX 및 태그 관리 기능 최신 변경점
- 태그 저장 버튼(개별 태깅) 제거, 태그 입력/엔터/목록/퀵태그 클릭 시 즉시 저장 및 UI 반영
- 파일 상세 정보 패널의 '모든 태그 삭제' 버튼 제거, 태그칩(x) 또는 일괄삭제 다이얼로그만 사용
- TagControlWidget <-> FileDetailWidget 태그칩 동기화: 태그 변경 시 양방향 시그널 구조로 항상 최신 상태 유지
- 일괄삭제 다이얼로그 내 TagChip x버튼 클릭 시, 선택 파일 전체에서 해당 태그 즉시 삭제 및 UI 반영
- 관련 기능명세, 이슈 문서도 동기화 업데이트
