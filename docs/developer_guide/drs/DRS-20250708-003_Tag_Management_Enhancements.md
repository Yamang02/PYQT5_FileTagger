# 개발 요청 명세 (DRS)

---
status: Approved
---
## 개발 요청 명세 (Development Request Specification)

*   **문서 ID**: `DRS-20250708-003`
*   **작성일**: `2025년 7월 8일`
*   **작성자**: `Gemini (기획팀)`
*   **관련 기능/모듈**: `태그 관리, 검색`
## 제목: 태그 관리 기능 강화 (삭제 일관성 및 커스텀 태그)
## 작성일: 2025년 7월 8일 화요일
## 상태: 완료 (2025-07-10)
## 버전: 1.0

---

### 1. 개요

본 문서는 FileTagger 애플리케이션의 태그 관리 기능을 개선하기 위한 개발 요구사항을 정의합니다. 현재 태그 추가 기능은 안정적이나, 태그 삭제 작업의 일관성을 확보하고 사용자가 자주 사용하는 태그를 효율적으로 관리할 수 있는 커스텀 태그 버튼 기능을 도입하여 사용자 경험을 향상시키는 것을 목표로 합니다.

### 2. 목표

*   태그 삭제 로직을 명확히 정의하고, 모든 태그 삭제 경로에서 일관된 사용자 경험을 제공합니다.
*   사용자가 자주 사용하는 태그를 등록하고 빠르게 적용할 수 있는 커스텀 태그 버튼 기능을 구현합니다.
*   커스텀 태그 목록이 애플리케이션 재시작 후에도 유지되도록 영속성을 확보합니다.

### 3. 기능 요구사항

#### 3.1. 태그 삭제 기능 일관성 확보

**3.1.1. 백엔드 (`core/tag_manager.py`)**

*   **`remove_tags_from_file(file_path: str, tags_to_remove: list[str]) -> bool`**:
    *   지정된 `file_path`에서 `tags_to_remove` 리스트에 포함된 태그들을 제거합니다.
    *   제거 후 해당 파일에 태그가 하나도 남지 않으면, 해당 파일의 태그 필드를 빈 리스트로 업데이트합니다.
    *   성공 시 `True`, 실패 시 `False`를 반환합니다.
*   **`clear_all_tags_from_file(file_path: str) -> bool`**:
    *   지정된 `file_path`의 모든 태그를 제거합니다.
    *   성공 시 `True`, 실패 시 `False`를 반환합니다.
*   **`remove_tags_from_files(file_paths: list[str], tags_to_remove: list[str]) -> dict`**:
    *   여러 `file_paths`에 대해 `tags_to_remove` 리스트에 포함된 태그들을 일괄적으로 제거합니다.
    *   `add_tags_to_files` 메서드와 유사한 반환 형식(처리 결과 정보)을 가집니다.

**3.1.2. 프론트엔드 (UI/UX)**

*   **개별 태그 칩 삭제**:
    *   `widgets/tag_chip.py`에 표시되는 각 태그 칩에 작은 'X' 버튼을 추가합니다.
    *   'X' 버튼 클릭 시 해당 태그를 현재 파일에서 제거하는 기능을 제공합니다. (사용자 확인 팝업 고려)
*   **파일 상세 보기 태그 전체 삭제**:
    *   파일 상세 보기(`file_detail_widget.py` 또는 관련 위젯)에서 현재 파일에 적용된 모든 태그를 한 번에 삭제할 수 있는 버튼을 제공합니다. (사용자 확인 팝업 필수)
*   **일괄 태깅 패널 태그 일괄 제거**:
    *   별도의 다이얼로그 또는 `widgets/batch_tagging_panel.py` 내에 선택된 파일들로부터 특정 태그를 일괄 제거할 수 있는 UI 요소를 추가합니다.
    *   사용자가 제거할 태그를 선택하거나 입력하고, 선택된 파일들에 대해 해당 태그를 일괄 제거할 수 있도록 합니다.
    *   **제약사항**: `BatchTaggingPanel`이 존재하지 않으므로, 일괄 태그 제거 기능의 UI 위치를 재정의해야 합니다.
    *   **선결과제**: 없음.

#### 3.2. 커스텀 태그 버튼 (Quick Tags) 관리 기능 강화

**3.2.1. 백엔드 (영속성)**

*   **커스텀 태그 저장/로드 메커니즘**:
    *   사용자가 설정한 커스텀 태그 목록을 영속적으로 저장하고 로드할 수 있는 방법을 정의합니다. (예: `config.py`에 새로운 설정 추가, 별도의 JSON 파일, 또는 MongoDB 내 사용자 설정 컬렉션)
    *   `TagManager` 또는 별도의 설정 관리 클래스에 `save_custom_quick_tags(tags: list[str])` 및 `load_custom_quick_tags() -> list[str]` 메서드를 추가합니다.

**3.2.2. 프론트엔드 (UI/UX)**

*   **커스텀 태그 관리 UI 진입점**:
    *   메인 윈도우의 메뉴바 '도구' 메뉴 아래에 '빠른 태그 관리' 항목을 추가하거나, `widgets/quick_tags_widget.py` 옆에 커스텀 태그 목록을 편집할 수 있는 버튼 (예: 톱니바퀴 아이콘 또는 '태그 관리' 버튼)을 추가합니다.
*   **커스텀 태그 편집 다이얼로그/패널**:
    *   위 진입점 클릭 시, 사용자가 커스텀 태그를 추가, 제거, 순서 변경할 수 있는 별도의 다이얼로그 또는 패널을 제공합니다.
    *   입력 필드와 추가/삭제 버튼, 목록 표시 영역을 포함합니다. 세부 구현 사항(예: 중복 태그 처리, 순서 변경 UI, 유효성 검사 등)은 개발을 진행하며 추가 논의가 필요합니다.
*   **커스텀 태그 적용**:
    *   `widgets/quick_tags_widget.py`에 표시된 커스텀 태그 버튼 클릭 시, 현재 선택된 파일에 해당 태그가 즉시 추가되도록 연동합니다. (기존 동작 유지)

### 4. 비기능 요구사항

*   **성능**: 대량의 파일 또는 태그 처리 시에도 UI 응답성을 유지해야 합니다.
*   **안정성**: 태그 삭제 및 커스텀 태그 관리 과정에서 데이터 손실이나 애플리케이션 비정상 종료가 발생하지 않아야 합니다.
*   **사용성**: 태그 삭제 및 커스텀 태그 관리 UI는 직관적이고 사용하기 쉬워야 합니다.
*   **일관성**: 기존 UI/UX 가이드라인 및 코드 컨벤션을 준수합니다.

### 5. 영향 범위

*   `core/tag_manager.py`: 태그 삭제 관련 신규 메서드 추가 및 기존 로직 수정.
*   `widgets/tag_chip.py`: 태그 칩 UI 수정 (삭제 버튼 추가).
*   `widgets/file_detail_widget.py` (또는 관련 위젯): 태그 전체 삭제 버튼 추가.
*   `widgets/batch_tagging_panel.py` 또는 `unified_tagging_panel.py`: 일괄 태그 제거 UI 추가.
*   `widgets/quick_tags_widget.py`: 커스텀 태그 관리 UI 진입점 추가 및 내부 로직 수정.
*   신규 위젯/다이얼로그: 커스텀 태그 편집을 위한 UI 파일 추가 가능성.
*   설정 파일 또는 DB 스키마: 커스텀 태그 영속성을 위한 변경.

### 6. 개발 및 테스트 고려사항

*   **단위 테스트**: `TagManager`의 신규 태그 삭제 메서드에 대한 단위 테스트를 철저히 작성합니다.
*   **통합 테스트**: UI와 백엔드 간의 태그 삭제 및 커스텀 태그 관리 연동에 대한 통합 테스트를 수행합니다.
*   **UI 테스트**: 태그 칩 삭제, 전체 태그 삭제, 일괄 태그 제거, 커스텀 태그 편집 다이얼로그 등 UI 요소의 동작을 확인합니다.


### 7. 산출물

*   업데이트된 `core/tag_manager.py`
*   업데이트된 UI/위젯 파일들
*   필요 시 신규 UI/위젯 파일들
*   관련 단위 및 통합 테스트 코드
*   업데이트된 문서 (DRS, `dev_notes.md`, `conversation_log.md` 등)

---