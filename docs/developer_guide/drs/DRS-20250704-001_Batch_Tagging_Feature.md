## 개발 요청 명세 (Development Request Specification)

*   **문서 ID**: `DRS-20250704-001`
*   **작성일**: `2025년 7월 4일`
*   **작성자**: `Gemini (기획팀)`
*   **관련 기능/모듈**: `태깅 기능, 파일 관리`
*   **관련 이슈**: `docs/issues.md`의 "파일 미선택 시 자주 사용하는 태그(QuickTagsWidget) 버튼 비활성화 동작 미흡" 이슈 (해결 완료)

---

### 1. 개요 (Overview)

이 개발 요청의 목적은 사용자가 특정 디렉토리 내의 파일들에 대해 일괄적으로 태그를 추가할 수 있는 기능을 제공하여 태그 관리의 효율성을 극대화하는 것입니다. 기존의 개별 파일 태깅 방식으로는 대량의 파일을 처리하기 어렵다는 사용자 문제를 해결하고, 태그 기반의 파일 분류 및 관리를 더욱 용이하게 하는 가치를 제공합니다. 이 기능은 FileTagger 애플리케이션의 핵심 태깅 기능을 보완하고 확장합니다.

### 2. 요구사항 (Requirements)

*   **2.1. 기능 요구사항 (Functional Requirements)**
    *   사용자는 특정 디렉토리를 선택하여 해당 디렉토리 내의 모든 파일에 태그를 일괄 추가할 수 있어야 합니다.
    *   사용자는 태그를 적용할 파일의 범위를 특정 파일 확장자(예: `.jpg`, `.png`, `.pdf`)로 필터링할 수 있어야 합니다.
    *   사용자는 하위 디렉토리 내의 파일에도 태그를 재귀적으로 적용할지 여부를 선택할 수 있어야 합니다.
    *   사용자는 태그를 입력할 때 기존 태그 목록을 기반으로 자동 완성 기능을 사용할 수 있어야 합니다.
    *   사용자는 일괄 태그 작업 실행 전, 태그가 적용될 파일 목록을 미리 확인할 수 있어야 합니다.
    *   일괄 태그 작업 중 UI가 멈추지 않고 백그라운드에서 처리되어야 합니다.
*   **2.2. 비기능 요구사항 (Non-Functional Requirements)**
    *   **성능**: 대량의 파일(예: 수천 개)에 태그를 일괄 적용하더라도 UI가 지연되거나 멈추지 않아야 합니다. (백그라운드 처리 필수)
    *   **사용성**: 일괄 태그 기능은 직관적이고 빠른 작업 흐름을 제공해야 합니다. (통합 패널 방식 채택)
    *   **확장성**: 향후 태그 일괄 삭제, 일괄 수정 등 추가적인 일괄 작업 기능 확장을 고려하여 설계되어야 합니다.
    *   **안정성**: 작업 중 오류 발생 시 사용자에게 명확한 피드백을 제공하고, 데이터 손실 없이 복구 가능해야 합니다.

### 3. UI/UX 설계 (User Interface / User Experience Design)

**통합 패널 방식 채택:**
별도의 다이얼로그 대신 메인 윈도우 내에 통합된 패널을 통해 일괄 태그 작업을 수행하여 작업 흐름의 단절을 최소화하고 효율성을 극대화합니다.

*   **접근 방식**:
    *   **전용 "일괄 태그 모드" 버튼/토글**: 메인 윈도우 상단 또는 파일 목록 근처에 "일괄 태그 모드" 버튼 또는 토글을 추가합니다.
    *   **메인 메뉴바 항목 추가**: "파일(File)" 또는 "도구(Tools)" 메뉴 아래에 "일괄 태그 추가(Batch Add Tags)" 메뉴 항목을 추가합니다.
*   **통합 패널 구성**:
    *   **패널 활성화**: "일괄 태그 모드" 버튼/토글 또는 메뉴바 항목 클릭 시 메인 윈도우의 특정 영역(예: 오른쪽 사이드바, 하단 패널)에 "일괄 태그 패널"이 나타납니다.
    *   **선택된 디렉토리/파일 표시**: 패널 상단에 현재 선택된 디렉토리 또는 파일 목록이 명확하게 표시됩니다.
        *   `treeView_dirs`에서 디렉토리를 우클릭하여 기능을 실행했을 경우, 해당 디렉토리 경로가 패널의 디렉토리 필드에 자동으로 채워지고 수정 불가능하도록 고정됩니다.
        *   메인 윈도우의 전용 버튼이나 메뉴바를 통해 열었을 경우, 사용자가 직접 디렉토리를 선택할 수 있도록 합니다.
    *   **파일 미리보기 영역**: 패널 내부에 선택된 디렉토리의 파일 목록을 보여주는 `QTableView` 또는 `QListView` 형태의 미리보기 영역을 추가합니다. 이 영역은 "적용 범위 선택" 옵션에 따라 실시간으로 업데이트되어, 어떤 파일들이 최종적으로 태그 적용 대상이 되는지 사용자가 즉시 확인할 수 있도록 합니다.
    *   **태그 입력/선택 영역**: 기존 `TagInputWidget`을 재사용하여 태그 입력 필드, 자동 완성, 태그 칩 표시 기능을 제공합니다.
    *   **적용 범위 선택 옵션**: "모든 파일", "특정 확장자 파일만" (예: `.jpg, .png` 등) 등의 옵션을 패널 내에 포함합니다.
    *   **"적용" 버튼**: 패널 내에서 태그 적용을 실행하는 버튼을 제공합니다.
    *   **모드 해제**: "일괄 태그 모드" 버튼/토글을 다시 클릭하거나, "적용" 버튼 클릭 후 작업이 완료되면 패널이 사라지도록 합니다.

### 4. 기술적 고려사항 (Technical Considerations)

*   **새로운 UI 컴포넌트**: `BatchTaggingPanel` (가칭) 위젯을 새로 구현합니다.
*   **상태 관리**: `TagUIStateManager`를 확장하여 `BatchTaggingPanel`의 상태(활성/비활성, 선택된 디렉토리/파일, 필터링 옵션 등)를 중앙 집중적으로 관리합니다.
*   **백엔드 연동**: `tag_manager.add_tags_to_directory` 메서드를 활용하여 실제 태그 추가 로직을 수행합니다.
*   **비동기 처리**: 대량 파일 처리 시 UI 블로킹을 방지하기 위해 `QThread`를 활용한 백그라운드 처리를 구현합니다.
*   **데이터베이스 최적화**: MongoDB 벌크 업데이트 기능을 활용하여 성능을 최적화합니다.

### 5. 테스트 시나리오 (Test Scenarios)

*   특정 디렉토리의 모든 파일에 태그를 일괄 추가.
*   특정 디렉토리의 특정 확장자 파일에만 태그를 일괄 추가.
*   재귀 옵션을 사용하여 하위 디렉토리 파일에 태그를 일괄 추가.
*   파일 미리보기 영역이 필터링 옵션에 따라 올바르게 업데이트되는지 확인.
*   일괄 태그 작업 중 UI가 멈추지 않고 진행 상태를 표시하는지 확인.
*   유효하지 않은 디렉토리 경로 입력 시 오류 처리.

### 6. 기타 (Miscellaneous)

*   더 상세한 UI/UX 흐름 및 구현 방향은 `docs/developer_guide/tagging_feature_spec.md`를 참고하십시오.
*   개발 과정에서 발생하는 기술적 논의는 `docs/developer_guide/dev_notes.md`에 기록해 주십시오.

---
